libname mydir "c:\users\Alec\Documents\My Work\11-12\HBS\Bank Leverage\";

proc datasets library = work /*kill*/;
	delete temp
		   temp1
		   temp_link
		   permcolink
		   permcolink1
		   permcolink2;
run;
quit;
libname in xport "c:\users\Alec\Documents\My Work\11-12\HBS\Bank Leverage\Call Reports\CALL9003.xpt";
data work.temp (keep = date rssd9001 rssd9348 RIAD4107 RIAD4073 RIAD4079 RIAD4093 RIAD4230 
				RIAD3128 RIAD3521 RIAD3196 RCFD1410 RCFD1763 RCFD1764 RCONB531 RCONB534 RCONB535 
				RCFD2107 RCFDB538 RCFDB539 RCFDK137 RCFDK207 RCFD1590 RCFD1563 RCON2165 RCFN3360 
				RCFD3531 RCFD3532 RCFD3533 RCFDG379 RCFDG380 RCFDG381 RCFDK197 RCFDK198 RCFDG383 
				RCFDG384 RCFDG385 RCFDG386 RCFD3381 RCFD3365 RCFD3401 RCFD0081 RCFD0071 RCFD2145 
				RCFD2150 RCFD3656 RCFD2130 RCFD2160 RCON2210 RCON2215 RCON6810 RCON0352 RCON6648 
				RCONJ473 RCONJ474 RCFN2200 RCONB993 RCFDB995 RCFD2651 RCFDB565 RCFDB566 RCFDB571 
				RCFDB567 RCFDB568 RCFD3190 RCFD2930 RCFD3200 RCFD3814 RCFD3815 RCFDF164 RCFDF165 
				RCFD6550 RCFDJ457 RCFDJ458 RCFDJ459 RCFD3817 RCFD3819 RCFD3820 RCFD3411 RCFDB705 
				RCFDB706 RCFDB707 RCFDB708 RCFDB709 RCFDB710 RCFDB711 RCFDB712 RCFDB713 RCFDB714 
				RCFDB715 RCFDB716 RCFDB717 RCFDB718 RCFDC393 RCFDC394 RCFDC395 RCFDC396 RCFDC397 
				RCFDC398 RCFDC399 RCFDC400 RCFDC401 RCFDC402 RCFDC403 RCFDC404 RCFDC405 RCFDC406 
				RCFDC968 RCFDC970 RCFDC972 RCFDC974 RCFDC969 RCFDC971 RCFDC973 RCFDC975 RCFD3792 
				RCON1415 RCONF158 RCONF159 RCON5367 RCON5368 RCON1797 RCON1797 RCON1420 RCON1460 
				RCON1480 RCONF160 RCONF161 RCONB538 RCONB539 RCON2011 RCON2107 RCON1756 RCON1757 
				RCFD2122 RCON2081 RCON1545 RCON1564 RCFD2746 RCONF174 RCONF175 RCON3494 RCON5399 
				RCONC237 RCONC239 RCON3500 RCONF180 RCONF181 RCFNB573 RCFD5378 RCFD5381 RCFD1597 
				RCFD1252 RCFD1255 RCFDB576 RCFDK214 RCFDK217 RCFD5390 RCFD5460 RCFDF167 RCFDF170 
				RCFD3506 RCONF176 RCONF177 RCON3495 RCON5400 RCONC229 RCONC230 RCON3501 RCONF182 
				RCONF183 RCFNB574 RCFD5379 RCFD5382 RCFD1583 RCFD1253 RCFD1256 RCFDB577 RCFDK215 
				RCFDK218 RCFD5391 RCFD5461 RCFDF168 RCFDF171 RCFD3507 RCONF172 RCONF173 RCON3493 
				RCON5398 RCONC236 RCONC238 RCON3499 RCONF178 RCONF179 RCFNB572 RCFD5377 RCFD5380 
				RCFD1594 RCFD1251 RCFD1254 RCFDB575 RCFDK213 RCFDK216 RCFD5389 RCFD5459 RCFDF166 
				RCFDF169 RCFD3505 RCONK106 RCONK109 RCONF662 RCONK112 RCONK115 RCONK118 RCFDK121 
				RCFDK124 RCFDK127 RCFDK107 RCFDK110 RCFDF663 RCFDK113 RCFDK116 RCFDK119 RCFDK122 
				RCFDK125 RCFDK128 RCONK105 RCONK108 RCONF661 RCONK111 RCONK114 RCONK117 RCFDK120 
				RCFDK120 RCFDK123 RCFDK126 RCONF576 RCONK158 RCONK159 RCONK160 RCONK161 RCONK162 
				RCFDK163 RCFDK164 RCFDK165 RCONF577 RCFD3368 RCFDA555 RCFDA556 RCFDA557 RCFDA558 
				RCFDA559 RCFDA560 RCFDA549 RCFDA550 RCFDA551 RCFDA552 RCFDA553 RCFDA554 RCFDA561 
				RCFDA562 RCFD8783 RCFDA590 RCFD1773 RCFD1754);
	set in.call9003;
	format date 6.;
	label date='Date';
	date = 19900330;
run;
libname in clear;
run;
%macro redecall(fn=);
libname in xport "c:\users\Alec\Documents\My Work\11-12\HBS\Bank Leverage\Call Reports\call&fn..xpt";
data work.temp1 (keep = date rssd9001 rssd9348 RIAD4107 RIAD4073 RIAD4079 RIAD4093 RIAD4230 
				RIAD3128 RIAD3521 RIAD3196 RCFD1410 RCFD1763 RCFD1764 RCONB531 RCONB534 RCONB535 
				RCFD2107 RCFDB538 RCFDB539 RCFDK137 RCFDK207 RCFD1590 RCFD1563 RCON2165 RCFN3360 
				RCFD3531 RCFD3532 RCFD3533 RCFDG379 RCFDG380 RCFDG381 RCFDK197 RCFDK198 RCFDG383 
				RCFDG384 RCFDG385 RCFDG386 RCFD3381 RCFD3365 RCFD3401 RCFD0081 RCFD0071 RCFD2145 
				RCFD2150 RCFD3656 RCFD2130 RCFD2160 RCON2210 RCON2215 RCON6810 RCON0352 RCON6648 
				RCONJ473 RCONJ474 RCFN2200 RCONB993 RCFDB995 RCFD2651 RCFDB565 RCFDB566 RCFDB571 
				RCFDB567 RCFDB568 RCFD3190 RCFD2930 RCFD3200 RCFD3814 RCFD3815 RCFDF164 RCFDF165 
				RCFD6550 RCFDJ457 RCFDJ458 RCFDJ459 RCFD3817 RCFD3819 RCFD3820 RCFD3411 RCFDB705 
				RCFDB706 RCFDB707 RCFDB708 RCFDB709 RCFDB710 RCFDB711 RCFDB712 RCFDB713 RCFDB714 
				RCFDB715 RCFDB716 RCFDB717 RCFDB718 RCFDC393 RCFDC394 RCFDC395 RCFDC396 RCFDC397 
				RCFDC398 RCFDC399 RCFDC400 RCFDC401 RCFDC402 RCFDC403 RCFDC404 RCFDC405 RCFDC406 
				RCFDC968 RCFDC970 RCFDC972 RCFDC974 RCFDC969 RCFDC971 RCFDC973 RCFDC975 RCFD3792 
				RCON1415 RCONF158 RCONF159 RCON5367 RCON5368 RCON1797 RCON1797 RCON1420 RCON1460 
				RCON1480 RCONF160 RCONF161 RCONB538 RCONB539 RCON2011 RCON2107 RCON1756 RCON1757 
				RCFD2122 RCON2081 RCON1545 RCON1564 RCFD2746 RCONF174 RCONF175 RCON3494 RCON5399 
				RCONC237 RCONC239 RCON3500 RCONF180 RCONF181 RCFNB573 RCFD5378 RCFD5381 RCFD1597 
				RCFD1252 RCFD1255 RCFDB576 RCFDK214 RCFDK217 RCFD5390 RCFD5460 RCFDF167 RCFDF170 
				RCFD3506 RCONF176 RCONF177 RCON3495 RCON5400 RCONC229 RCONC230 RCON3501 RCONF182 
				RCONF183 RCFNB574 RCFD5379 RCFD5382 RCFD1583 RCFD1253 RCFD1256 RCFDB577 RCFDK215 
				RCFDK218 RCFD5391 RCFD5461 RCFDF168 RCFDF171 RCFD3507 RCONF172 RCONF173 RCON3493 
				RCON5398 RCONC236 RCONC238 RCON3499 RCONF178 RCONF179 RCFNB572 RCFD5377 RCFD5380 
				RCFD1594 RCFD1251 RCFD1254 RCFDB575 RCFDK213 RCFDK216 RCFD5389 RCFD5459 RCFDF166 
				RCFDF169 RCFD3505 RCONK106 RCONK109 RCONF662 RCONK112 RCONK115 RCONK118 RCFDK121 
				RCFDK124 RCFDK127 RCFDK107 RCFDK110 RCFDF663 RCFDK113 RCFDK116 RCFDK119 RCFDK122 
				RCFDK125 RCFDK128 RCONK105 RCONK108 RCONF661 RCONK111 RCONK114 RCONK117 RCFDK120 
				RCFDK120 RCFDK123 RCFDK126 RCONF576 RCONK158 RCONK159 RCONK160 RCONK161 RCONK162 
				RCFDK163 RCFDK164 RCFDK165 RCONF577 RCFD3368 RCFDA555 RCFDA556 RCFDA557 RCFDA558 
				RCFDA559 RCFDA560 RCFDA549 RCFDA550 RCFDA551 RCFDA552 RCFDA553 RCFDA554 RCFDA561 
				RCFDA562 RCFD8783 RCFDA590 RCFD1773 RCFD1754);
	set in.call&fn.;
	format date 6.;
	label date='Date';
	if &fn. > 9000 then date = 19&fn.30;
	else date = 20&fn.30;
run;
proc append base = work.temp
            data = work.temp1;
run;
proc datasets library = work;
  delete temp1;
run;
libname in clear;
run;
%mend redecall;

%redecall(fn=9006);
%redecall(fn=9009);
%redecall(fn=9012);
%redecall(fn=9103);
%redecall(fn=9106);
%redecall(fn=9109);
%redecall(fn=9112);
%redecall(fn=9203);
%redecall(fn=9206);
%redecall(fn=9209);
%redecall(fn=9212);
%redecall(fn=9303);
%redecall(fn=9306);
%redecall(fn=9309);
%redecall(fn=9312);
%redecall(fn=9403);
%redecall(fn=9406);
%redecall(fn=9409);
%redecall(fn=9412);
%redecall(fn=9503);
%redecall(fn=9506);
%redecall(fn=9509);
%redecall(fn=9512);
%redecall(fn=9603);
%redecall(fn=9606);
%redecall(fn=9609);
%redecall(fn=9612);
%redecall(fn=9703);
%redecall(fn=9706);
%redecall(fn=9709);
%redecall(fn=9712);
%redecall(fn=9803);
%redecall(fn=9806);
%redecall(fn=9809);
%redecall(fn=9812);
%redecall(fn=9903);
%redecall(fn=9906);
%redecall(fn=9909);
%redecall(fn=9912);
%redecall(fn=0003);
%redecall(fn=0006);
%redecall(fn=0009);
%redecall(fn=0012);
%redecall(fn=0103);
%redecall(fn=0106);
%redecall(fn=0109);
%redecall(fn=0112);
%redecall(fn=0203);
%redecall(fn=0206);
%redecall(fn=0209);
%redecall(fn=0212);
%redecall(fn=0303);
%redecall(fn=0306);
%redecall(fn=0309);
%redecall(fn=0312);
%redecall(fn=0403);
%redecall(fn=0406);
%redecall(fn=0409);
%redecall(fn=0412);
%redecall(fn=0503);
%redecall(fn=0506);
%redecall(fn=0509);
%redecall(fn=0512);
%redecall(fn=0603);
%redecall(fn=0606);
%redecall(fn=0609);
%redecall(fn=0612);
%redecall(fn=0703);
%redecall(fn=0706);
%redecall(fn=0709);
%redecall(fn=0712);

data temp_link;
	set mydir.fed_crsp_link (keep = entity permco dt_start dt_end);
	entity_new = entity+0;
	drop entity;
	rename entity_new = entity;
run;

proc sort data = temp;
	by rssd9001;
run;

proc sql;
	create table permcolink1 as
	select a.*,b.*
	from temp a, temp_link b
	where a.rssd9001 = b.entity
		and a.date <= b.dt_end
		and a.date >= b.dt_start;
run;

proc sql;
	create table permcolink2 as
	select a.*,b.*
	from temp a, temp_link b
	where a.rssd9348 = b.entity
		and a.date <= b.dt_end
		and a.date >= b.dt_start;
run;

data mydir.permcolink;
	merge permcolink1 permcolink2;
run;



